<!doctype html>

<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dankbarkeit</title>
    <style>
      :root {
        --bg: #ffffff;
        --text: #0f172a;
        --muted: #64748b;
        --border: #e2e8f0;
        --accent: #2563eb;
        --accent-2: #1d4ed8;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: var(--bg);
        color: var(--text);
      }
      .container {
        max-width: 760px;
        margin: 0 auto;
        padding: 24px 16px 48px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 20px;
      }
      h1 {
        font-size: 20px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      nav {
        display: flex;
        gap: 8px;
      }
      .tab {
        border: 1px solid var(--border);
        background: #fff;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        color: var(--text);
      }
      .tab.active {
        border-color: rgba(37, 99, 235, 0.35);
        background: rgba(37, 99, 235, 0.06);
        color: var(--accent-2);
      }
      .card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        background: #fff;
      }
      .date {
        font-size: 14px;
        color: var(--muted);
        margin-bottom: 10px;
      }
      .question {
        font-size: 18px;
        margin: 0 0 12px 0;
        line-height: 1.3;
      }
      textarea {
        width: 100%;
        min-height: 140px;
        resize: vertical;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        font-size: 15px;
        line-height: 1.5;
        outline: none;
      }
      textarea:focus {
        border-color: rgba(37, 99, 235, 0.6);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-top: 12px;
      }
      .hint {
        font-size: 13px;
        color: var(--muted);
      }
      button {
        border: none;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover { background: var(--accent-2); }
      button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
      }
      .history-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .history-item {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        background: #fff;
      }
      .history-item .top {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 8px;
      }
      .history-item .d {
        font-size: 14px;
        color: var(--muted);
      }
      .history-item .content {
        white-space: pre-wrap;
        line-height: 1.55;
        font-size: 15px;
      }
      .empty {
        color: var(--muted);
        font-size: 14px;
        padding: 12px;
        text-align: center;
        border: 1px dashed var(--border);
        border-radius: 14px;
        background: #fff;
      }
      footer {
        margin-top: 18px;
        color: var(--muted);
        font-size: 12px;
      }
      code { background: #f1f5f9; padding: 2px 6px; border-radius: 8px; }
      .success {
        background: #dcfce7;
        border: 1px solid #86efac;
        color: #166534;
        padding: 10px;
        border-radius: 10px;
        margin-top: 12px;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <h1>Dankbarkeits-App</h1>
        <nav>
          <button class="tab active" id="tab-today" type="button">Heute</button>
          <button class="tab" id="tab-history" type="button">Historie</button>
        </nav>
      </header>

```
  <main id="view"></main>

  <footer>
    Speicherung lokal im Browser via <code>localStorage</code>. Deine Daten bleiben dauerhaft gespeichert.
  </footer>
</div>

<script>
  // ---------------------------
  // Storage / Datenmodell
  // ---------------------------
  const STORAGE_KEY = "gratitude_entries_v1";

  function loadEntries() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      const parsed = JSON.parse(raw);
      return parsed || {};
    } catch {
      return {};
    }
  }

  function saveEntries(entries) {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
      return true;
    } catch (e) {
      console.error('Fehler beim Speichern:', e);
      return false;
    }
  }

  function upsertEntry(dateKey, text) {
    const entries = loadEntries();
    entries[dateKey] = { text, createdAt: Date.now() };
    return saveEntries(entries);
  }

  // ---------------------------
  // Date helpers
  // ---------------------------
  function pad2(n) { return String(n).padStart(2, "0"); }

  function todayKey() {
    const d = new Date();
    const y = d.getFullYear();
    const m = pad2(d.getMonth() + 1);
    const day = pad2(d.getDate());
    return `${y}-${m}-${day}`;
  }

  function formatDateDE(dateKey) {
    const [y, m, d] = dateKey.split("-").map(Number);
    const dt = new Date(y, m - 1, d);
    return dt.toLocaleDateString("de-DE", { weekday: "long", year: "numeric", month: "long", day: "2-digit" });
  }

  // ---------------------------
  // UI State / Routing
  // ---------------------------
  let route = "today";

  const view = document.getElementById("view");
  const tabToday = document.getElementById("tab-today");
  const tabHistory = document.getElementById("tab-history");

  tabToday.addEventListener("click", () => setRoute("today"));
  tabHistory.addEventListener("click", () => setRoute("history"));

  function setRoute(next) {
    route = next;
    tabToday.classList.toggle("active", route === "today");
    tabHistory.classList.toggle("active", route === "history");
    render();
  }

  // ---------------------------
  // Views
  // ---------------------------
  function renderToday() {
    const key = todayKey();
    const entries = loadEntries();
    const existing = entries[key]?.text ?? "";

    view.innerHTML = `
      <section class="card">
        <div class="date">${formatDateDE(key)}</div>
        <h2 class="question">Wofür bin ich heute dankbar?</h2>
        <textarea id="gratitude-input" placeholder="Schreibe hier deinen Eintrag..."></textarea>
        <div class="row">
          <div class="hint">Ein Eintrag pro Tag (überschreibt den heutigen Eintrag).</div>
          <button id="send-btn" type="button">Senden</button>
        </div>
        <div id="success-msg"></div>
      </section>
    `;

    const textarea = document.getElementById("gratitude-input");
    const sendBtn = document.getElementById("send-btn");
    const successMsg = document.getElementById("success-msg");

    textarea.value = existing;
    sendBtn.disabled = textarea.value.trim().length === 0;

    textarea.addEventListener("input", () => {
      sendBtn.disabled = textarea.value.trim().length === 0;
    });

    sendBtn.addEventListener("click", () => {
      const text = textarea.value.trim();
      if (!text) return;
      
      const success = upsertEntry(key, text);
      
      if (success) {
        successMsg.innerHTML = '<div class="success">✓ Eintrag gespeichert!</div>';
        setTimeout(() => {
          setRoute("history");
        }, 1000);
      } else {
        alert('Fehler beim Speichern. Bitte versuche es erneut.');
      }
    });
  }

  function renderHistory() {
    const entries = loadEntries();
    const sorted = Object.entries(entries)
      .sort((a, b) => b[0].localeCompare(a[0]));

    if (sorted.length === 0) {
      view.innerHTML = `<div class="empty">Noch keine Einträge vorhanden. Erstelle deinen ersten Eintrag!</div>`;
      return;
    }

    const items = sorted.map(([date, entry]) => `
      <div class="history-item">
        <div class="top">
          <div class="d">${formatDateDE(date)}</div>
        </div>
        <div class="content">${escapeHtml(entry.text)}</div>
      </div>
    `).join("");

    view.innerHTML = `
      <section class="history-list">
        ${items}
      </section>
    `;
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;")
      .replaceAll("\n", "<br/>");
  }

  function render() {
    if (route === "today") renderToday();
    else renderHistory();
  }

  render();
</script>
```

  </body>
</html>
